<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="wasm_exec.js"></script>
    <script>
      const go = new Go();
      WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
          go.run(result.instance);
      });
    </script>
    <title>Document</title>
  </head>
  <body>
    <section class="editors" style="display: flex">
      <div>
        <h3>Template</h3>
        <textarea id="template" class="code"></textarea>
      </div>
      <div>
        <h3>JSON data</h3>
        <textarea id="data" class="code"></textarea>
      </div>
    </section>
    <h3>Result</h3>
    <p class="display"></p>
  </body>
<style>
  textarea {
    width: 50vw;
    height: 50vh;
  }
  .code {
    font-family: monospace;
  }
</style>
  <script>
    const template = document.getElementById("template");
    const data = document.getElementById("data");

    template.addEventListener("keyup", handleChange);
    data.addEventListener("keyup", handleChange);


    function handleChange() {
      let display = document.querySelector(".display");

      let jsonData = data.value ? data.value : "{}";
      const {result, error} = execute(template.value, jsonData);

      if(error) {
        display.classList.remove("code")
        display.innerText = error;
        return;
      }

      let pretty = JSON.stringify(JSON.parse(result), null, "\t")
      display.classList.add("code")
      display.innerHTML = `<pre>${pretty}</pre>`

    }
  </script>
</html>
